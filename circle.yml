general:
  branches:
    only:
      - master
      - staging
      - production
machine:
  node:
    version: 5.2.0
checkout:
  post:
    - git submodule sync
    - git submodule update --init --recursive
    - git submodule foreach git fetch --tags
    - cd dist/v1/OnsenUI; git fetch --tags; git checkout `git tag | grep "^1." | sort --version-sort | tail -n 1`; cd ../../..; # Latest 1.x
    - cd dist/v2/OnsenUI; git fetch --tags; git checkout master; git pull; cd ../../..;
    - cd dist/v2/react-onsenui; git fetch --tags; git checkout master; git pull; cd ../../..;
dependencies:
  override:
    - sudo apt-get update; sudo apt-get install g++
    - npm install
    - npm install -g gulp
    - cd dist/v1/OnsenUI/css-components; npm install; gulp build; cd ../../../../;
    - cd dist/v1/OnsenUI; npm install; gulp build; gulp build-docs; cd ../../..;
    - cd dist/v2/OnsenUI/css-components; npm install; gulp build; cd ../../../../;
    - cd dist/v2/OnsenUI; npm install; gulp build; gulp build-docs; cd ../../..;
test:
  override:
    - echo "Add tests!"
deployment:
  staging:
    branch: [master, staging]
    commands:
      - npm install -g gulp
      - AWS_BUCKET=${AWS_BUCKET_EN} gulp deploy --lang=en
      - AWS_BUCKET=${AWS_BUCKET_JA} gulp deploy --lang=ja
  production:
    branch: production
    commands:
      - npm install -g gulp
      - AWS_BUCKET=${AWS_BUCKET_EN_PROD} gulp deploy --lang=en --production
      - AWS_BUCKET=${AWS_BUCKET_JA_PROD} gulp deploy --lang=ja --production

